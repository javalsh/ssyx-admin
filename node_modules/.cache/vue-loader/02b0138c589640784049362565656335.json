{"remainingRequest":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/activity/couponInfo/rule.vue?vue&type=style&index=0&id=938eec5e&lang=css&","dependencies":[{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/activity/couponInfo/rule.vue","mtime":1678846942000},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/css-loader/dist/cjs.js","mtime":1688442891416},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1688442881225},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/postcss-loader/src/index.js","mtime":1688442891149},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/cache-loader/dist/cjs.js","mtime":1688442891160},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js","mtime":1688442880248}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmFwcC1jb250YWluZXIgaDQgewogIGNvbG9yOiAjNjA2MjY2Owp9Cg=="},{"version":3,"sources":["rule.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4VA;AACA;AACA","file":"rule.vue","sourceRoot":"src/views/activity/couponInfo","sourcesContent":["<template>\n  <div class=\"app-container\">\n\n    <h4>优惠券信息</h4>\n    <table class=\"table table-striped table-condenseda table-bordered\" width=\"100%\">\n      <tbody>\n      <tr>\n        <th width=\"15%\">优惠券名称</th>\n        <td width=\"35%\"><b style=\"font-size: 14px\">{{ couponInfo.couponName }}</b></td>\n        <th width=\"15%\">优惠券类型</th>\n        <td width=\"35%\">\n          {{ couponInfo.couponTypeString }}\n        </td>\n      </tr>\n      <tr>\n        <th>发行数量</th>\n        <td>{{ couponInfo.publishCount }}</td>\n        <th>每人限领次数</th>\n        <td>{{ couponInfo.perLimit }}</td>\n      </tr>\n      <tr>\n        <th>领取时间</th>\n        <td>{{ couponInfo.startTime }}至{{ couponInfo.endTime }}</td>\n        <th>过期时间</th>\n        <td>{{ couponInfo.expireTime }}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <h4>添加规则</h4>\n    <el-form label-width=\"140px\" style=\"background: #f9f9f9;padding-top: 15px; padding-bottom: 1px;\">\n      <el-form-item v-if=\"couponInfo.couponType == 'CASH'\" label=\"现金券金额（元）\" style=\"width: 50%;\">\n        <el-input v-model=\"couponInfo.amount\"/>\n      </el-form-item>\n\n      <el-form-item v-if=\"couponInfo.couponType == 'FULL_REDUCTION'\" label=\"满减金额（元）\" style=\"width: 50%;\">\n        <el-input v-model=\"couponInfo.conditionAmount\"/>\n      </el-form-item>\n\n      <el-form-item v-if=\"couponInfo.couponType == 'FULL_REDUCTION'\" label=\"优惠金额（元）\" style=\"width: 50%;\">\n        <el-input v-model=\"couponInfo.amount\"/>\n      </el-form-item>\n    </el-form>\n\n    <h4>优惠券范围选择</h4>\n    <el-form label-width=\"0px\" style=\"background: #f9f9f9;padding-top: 15px;padding-left: 15px; padding-bottom: 1px;\">\n      <el-form-item>\n        <el-radio-group v-model=\"couponInfo.rangeType\">\n          <el-radio label=\"ALL\">通用</el-radio>\n          <el-radio label=\"SKU\">SKU</el-radio>\n          <el-radio label=\"CATEGORY\">分类</el-radio>\n        </el-radio-group>\n      </el-form-item>\n    </el-form>\n\n    <div v-if=\"couponInfo.rangeType == 'SKU'\">\n      <el-dialog title=\"添加范围\" :visible.sync=\"dialogSkduRangVisible\" width=\"490px\">\n        <div style=\"margin-top: 20px;\">\n          <el-form :inline=\"true\" class=\"demo-form-inline\">\n            <el-form-item>\n              <el-autocomplete\n                v-model=\"keyword\"\n                :fetch-suggestions=\"querySkuSearch\"\n                :trigger-on-focus=\"false\"\n                class=\"inline-input\"\n                placeholder=\"请输入关键字，选择活动商品\"\n                value-key=\"skuName\"\n                style=\"width: 400px;\"\n                @select=\"selectSkuData\"\n              />\n            </el-form-item>\n\n            <el-form-item>\n              <el-button type=\"\" @click=\"dialogSkduRangVisible = false\">取消</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </el-dialog>\n      <h4>\n        优惠券范围列表&nbsp;&nbsp;&nbsp;\n        <el-button type=\"\" size=\"mini\" @click=\"dialogSkduRangVisible = true\">添加优惠券范围</el-button>\n      </h4>\n      <el-table\n        v-loading=\"listLoading\"\n        :data=\"skuInfoList\"\n        border\n        fit\n        highlight-current-row>\n\n        <el-table-column\n          label=\"序号\"\n          width=\"70\"\n          align=\"center\">\n          <template slot-scope=\"scope\">\n            {{ scope.$index + 1 }}\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"id\" label=\"sku ID\" width=\"100\"/>\n        <el-table-column prop=\"skuName\" label=\"sku名称\" width=\"120\"/>\n        <el-table-column prop=\"skuCode\" label=\"sku编号\" />\n\n        <el-table-column label=\"操作\" width=\"200\" align=\"center\">\n          <template slot-scope=\"scope\">\n            <el-button type=\"text\" size=\"mini\" @click=\"removeSkuDataById(scope.$index)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n\n    <div v-if=\"couponInfo.rangeType == 'CATEGORY'\">\n      <el-dialog title=\"添加范围\" :visible.sync=\"dialogCateRangVisible\" width=\"490px\">\n        <div style=\"margin-top: 20px;\">\n          <el-form :inline=\"true\" class=\"demo-form-inline\">\n            <el-select placeholder=\"请选择\" style=\"width: 300px\" @change=\"selectCategory\">\n              <el-option\n                v-for=\"category in selectCategoryList\"\n                :key=\"category.id\"\n                :label=\"category.name\"\n                :value=\"category.id\"/>\n            </el-select>\n\n            <el-form-item>\n              <el-button type=\"\" @click=\"dialogCateRangVisible = false\">取消</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </el-dialog>\n      <h4>\n        优惠券范围列表&nbsp;&nbsp;&nbsp;\n        <el-button type=\"\" size=\"mini\" @click=\"dialogCateRangVisible = true\">添加优惠券范围</el-button>\n      </h4>\n      <el-table\n        v-loading=\"listLoading\"\n        :data=\"categoryList\"\n        border\n        fit\n        highlight-current-row>\n\n        <el-table-column\n          label=\"序号\"\n          width=\"70\"\n          align=\"center\">\n          <template slot-scope=\"scope\">\n            {{ scope.$index + 1 }}\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"id\" label=\"分类ID\" width=\"100\"/>\n        <el-table-column prop=\"name\" label=\"名称\" />\n\n        <el-table-column label=\"操作\" width=\"200\" align=\"center\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" type=\"text\" @click=\"removeCateDataById(scope.$index)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n\n    <div v-if=\"couponInfo.rangeType == 'ALL'\">\n      <span>通用</span>\n    </div>\n\n    <div style=\"margin-top: 15px;\">\n      <el-form label-width=\"0px\">\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"save\">保存</el-button>\n          <el-button @click=\"back\">返回</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport api from '@/api/activity/couponInfo'\nimport activityInfoApi from '@/api/activity/activityInfo'\nimport categoryApi from '@/api/product/category'\n\nexport default {\n  data() {\n    return {\n      listLoading: false, // 数据是否正在加载\n\n      couponInfo: {},\n      saveBtnDisabled: false,\n\n      // 优惠券范围：SPU\n      dialogSkduRangVisible: false,\n      keyword: '',\n      skuInfoList: [],\n\n      // 优惠券范围：三级分类\n      dialogCateRangVisible: false,\n      categoryList: [],\n      selectCategoryList: []\n    }\n  },\n\n  // 监听器\n  watch: {\n    $route(to, from) {\n      console.log('路由变化......')\n      console.log(to)\n      console.log(from)\n      this.init()\n    }\n  },\n\n  // 生命周期方法（在路由切换，组件不变的情况下不会被调用）\n  created() {\n    console.log('form created ......')\n    this.init()\n  },\n\n  methods: {\n\n    // 表单初始化\n    init() {\n      const couponId = this.$route.params.id\n      // 获取优惠券信息\n      this.fetchDataById(couponId)\n\n      // 获取优惠券规则与范围信息\n      this.fetchRuleDataById(couponId)\n\n      this.fetchCategoryList()\n    },\n\n    fetchCategoryList() {\n      categoryApi.findAllList().then(response => {\n        this.selectCategoryList = response.data\n      })\n    },\n\n    // 提交保存数据\n    save() {\n      let rangeDesc = '可购买'\n      const couponRangeList = []\n      if (this.couponInfo.rangeType === 'SKU') {\n        this.skuInfoList.forEach(function(item) {\n          rangeDesc += '：'\n          couponRangeList.push({\n            rangeType: 'SKU',\n            rangeId: item.id\n          })\n          rangeDesc += item.spuName + ','\n        })\n      }\n      if (this.couponInfo.rangeType === 'CATEGORY') {\n        rangeDesc += '分类：'\n        this.categoryList.forEach(function(item) {\n          couponRangeList.push({\n            rangeType: 'CATEGORY',\n            rangeId: item.id\n          })\n          rangeDesc += item.name + ','\n        })\n      }\n      if (this.couponInfo.rangeType === 'ALL') {\n        rangeDesc +=  '全场通用,'\n      }\n      if (rangeDesc.length > 3) {\n        rangeDesc = rangeDesc.substring(0, rangeDesc.length - 1)\n      } else {\n        rangeDesc = this.couponInfo.couponName\n      }\n      const ruleData = {\n        couponId: this.couponInfo.id,\n        rangeType: this.couponInfo.rangeType,\n        amount: this.couponInfo.amount,\n        conditionAmount: this.couponInfo.conditionAmount,\n        couponRangeList: couponRangeList,\n        rangeDesc: rangeDesc\n      }\n\n      api.saveCouponRule(ruleData).then(response => {\n        this.$message.success(response.message)\n        this.$router.push({ path: '/activity/couponInfo/list' })\n      })\n    },\n\n    removeDataById(index) {\n      this.activityRuleList.splice(index, 1)\n    },\n\n    back() {\n      // this.$router.push({ path: '/activity/couponInfo/list' })\n      window.history.go(-1)\n    },\n\n    fetchRuleDataById(id) {\n      api.findCouponRuleList(id).then(response => {\n\n        this.skuInfoList = response.data.skuInfoList || []\n        this.categoryList = response.data.categoryList || []\n        this.trademarkList = response.data.trademarkList || []\n      })\n    },\n\n    // 根据id查询记录\n    fetchDataById(id) {\n      api.getById(id).then(response => {\n        //\n        this.couponInfo = response.data\n      })\n    },\n\n    querySkuSearch(queryString, cb) {\n      console.log(queryString)\n      console.log(cb)\n\n      activityInfoApi.findSkuInfoByKeyword(queryString).then(response => {\n        // 调用 callback 返回建议列表的数据\n        cb(response.data)\n      })\n    },\n\n    selectSkuData(item) {\n\n      this.skuInfoList.push(item)\n      this.dialogSkduRangVisible = false\n    },\n\n    removeSkuDataById(index) {\n      this.skuInfoList.splice(index, 1)\n    },\n\n    selectCategory(categoryId) {\n      console.log(categoryId)\n      categoryApi.getById(categoryId)\n          .then(response => {\n              this.categoryList.push({\n                id: categoryId,\n                name: response.data.name\n              })\n          })\n      this.dialogCateRangVisible = false\n    },\n\n    removeCateDataById(index) {\n      this.categoryList.splice(index, 1)\n    }\n  }\n}\n</script>\n<style>\n  .app-container h4 {\n    color: #606266;\n  }\n</style>\n"]}]}