{"remainingRequest":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/product/skuInfo/form.vue?vue&type=style&index=0&id=a4271dbc&scoped=true&lang=css&","dependencies":[{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/product/skuInfo/form.vue","mtime":1678764902000},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/css-loader/dist/cjs.js","mtime":1688442891416},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1688442881225},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/postcss-loader/src/index.js","mtime":1688442891149},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/cache-loader/dist/cjs.js","mtime":1688442891160},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js","mtime":1688442880248}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmxpdHRsZU1hcmdpblRvcCB7CiAgbWFyZ2luLXRvcDogMTBweDsKfQoKLnBhcmFtSW5wdXQgewogIHdpZHRoOiAyNTBweDsKfQoKLnBhcmFtSW5wdXRMYWJlbCB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHdpZHRoOiAxMDBweDsKICB0ZXh0LWFsaWduOiByaWdodDsKICBwYWRkaW5nLXJpZ2h0OiAxMHB4Cn0KCi5jYXJkQmcgewogIGJhY2tncm91bmQ6ICNGOEY5RkM7Cn0K"},{"version":3,"sources":["form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqZA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"form.vue","sourceRoot":"src/views/product/skuInfo","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-form label-width=\"120px\" size=\"small\">\n\n      <div style=\"background-color:#E0E0E0;width: 100%;padding: 0 10px;margin: 10px 0;\"><h3>基本信息</h3></div>\n      <el-form-item label=\"sku名称\">\n        <el-input v-model=\"skuInfo.skuName\" />\n      </el-form-item>\n      <el-form-item label=\"商品分类\" prop=\"tmId\">\n        <el-select v-model=\"skuInfo.categoryId\" placeholder=\"请选择\" >\n          <el-option\n            v-for=\"category in categoryList\"\n            :key=\"category.id\"\n            :label=\"category.name\"\n            :value=\"category.id\"/>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"SKU编号：\">\n        <el-input v-model=\"skuInfo.skuCode\" ></el-input>\n      </el-form-item>\n      <el-form-item label=\"商品售价：\">\n        <el-input v-model=\"skuInfo.price\" ></el-input>\n      </el-form-item>\n      <el-form-item label=\"市场价：\">\n        <el-input v-model=\"skuInfo.marketPrice\" ></el-input>\n      </el-form-item>\n      <el-form-item label=\"是否新人专享:\">\n        <el-radio-group v-model=\"skuInfo.isNewPerson\">\n          <el-radio :label=\"0\">否</el-radio>\n          <el-radio :label=\"1\">是</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <el-form-item label=\"排序\">\n        <el-input v-model=\"skuInfo.sort\" ></el-input>\n      </el-form-item>\n\n      <div style=\"background-color:#E0E0E0;width: 100%;padding: 0 10px;margin: 10px 0;\"><h3>平台属性</h3></div>\n      <el-form-item label=\"属性分组\" prop=\"tmId\">\n        <el-select v-model=\"skuInfo.attrGroupId\" placeholder=\"请选择\"  @change=\"selectAttrChange\">\n          <el-option\n            v-for=\"attrGroup in attrGroupList\"\n            :key=\"attrGroup.id\"\n            :label=\"attrGroup.name\"\n            :value=\"attrGroup.id\"/>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"平台属性：\">\n        <el-card shadow=\"never\" class=\"cardBg\">\n          <div :key=\"item.id\" v-for=\"(item,index) in attrList\" :class=\"{littleMarginTop:index!==0}\">\n            <div class=\"paramInputLabel\">{{item.name}}:</div>\n            <el-select v-if=\"item.inputType===1\" class=\"paramInput\" v-model=\"attrList[index].value\" style=\"width: 300px\">\n              <el-option\n                v-for=\"item in getParamSelectList(item.selectList)\"\n                :key=\"item\"\n                :label=\"item\"\n                :value=\"item\">\n              </el-option>\n            </el-select>\n            <el-input v-else class=\"paramInput\" v-model=\"attrList[index].value\" style=\"width: 300px\"></el-input>\n          </div>\n        </el-card>\n      </el-form-item>\n\n      <div style=\"background-color:#E0E0E0;width: 100%;padding: 0 10px;margin: 10px 0;\"><h3>商品图片</h3></div>\n      <el-form-item label=\"图片上传\" >\n        <el-upload\n          :on-success=\"onUploadSuccess\"\n          :before-upload=\"beforeUpload\"\n          :on-preview=\"onUploadPreview\"\n          :on-remove=\"onUploadRemove\"\n          :multiple=\"true\"\n          :action=\"BASE_API+'/admin/product/fileUpload'\"\n          class=\"upload-demo\"\n          list-type=\"picture-card\"\n          :file-list=\"fileList\">\n          <i class=\"el-icon-plus\"/>\n          <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png/gif文件，且不超过2MB</div>\n        </el-upload>\n      </el-form-item>\n\n      <div style=\"background-color:#E0E0E0;width: 100%;padding: 0 10px;margin: 10px 0;\"><h3>商品库存</h3></div>\n      <el-form-item label=\"商品库存：\">\n        <el-input v-model=\"skuInfo.stock\" ></el-input>\n      </el-form-item>\n      <el-form-item label=\"商品预警库存：\">\n        <el-input v-model=\"skuInfo.lowStock\" ></el-input>\n      </el-form-item>\n      <el-form-item label=\"限购个数：\">\n        <el-input v-model=\"skuInfo.perLimit\" ></el-input>\n      </el-form-item>\n\n<!--      <div style=\"background-color:#E0E0E0;width: 100%;padding: 0 10px;margin: 10px 0;\"><h3>商品详情</h3></div>-->\n<!--      <el-form-item label=\"商品详情\">-->\n<!--        <el-input v-model=\"skuInfo.skuDetail.detailHtml\" type=\"textarea\" :rows=\"10\"></el-input>-->\n<!--      </el-form-item>-->\n      <div style=\"background-color:#E0E0E0;width: 100%;padding: 0 10px;margin: 10px 0;\"><h3>商品海报</h3></div>\n      <el-form-item label=\"上传海报\" >\n        <el-upload\n          :on-success=\"onUploadPosterSuccess\"\n          :before-upload=\"beforeUpload\"\n          :on-preview=\"onUploadPreview\"\n          :on-remove=\"onUploadPosterRemove\"\n          :multiple=\"true\"\n          :action=\"BASE_API+'/admin/product/fileUpload'\"\n          class=\"upload-demo\"\n          list-type=\"picture-card\"\n          :file-list=\"filePosterList\">\n          <i class=\"el-icon-plus\"/>\n          <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png/gif文件，且不超过2MB</div>\n        </el-upload>\n      </el-form-item>\n\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"saveOrUpdate\">保存</el-button>\n        <el-button @click=\"back\">返回</el-button>\n      </el-form-item>\n    </el-form>\n\n    <!--图片预览-->\n    <el-dialog :visible.sync=\"dialogImageVisible\">\n      <img :src=\"dialogImageUrl\" width=\"100%\" alt=\"\">\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n\nimport api from '@/api/product/skuInfo'\nimport categoryApi from '@/api/product/category'\nimport attrGroupApi from '@/api/product/attrGroup'\nimport attrApi from '@/api/product/attr'\n\nconst defaultForm = {\n  id: '',\n  categoryId: '',\n  attrGroupId: '',\n  skuType: 0,\n  skuName: '',\n  perLimit: 1,\n  isNewPerson: 0,\n  sort: '',\n  imgUrl: '',\n  skuCode: '',\n  price: '',\n  marketPrice: '',\n  stock: '',\n  lowStock: '',\n  skuAttrValueList: [],\n  skuPosterList: [],\n  skuImagesList: []\n}\n\nexport default {\n  data() {\n    return {\n      // 接口API地址\n      BASE_API: 'http://localhost:8203',\n\n      skuInfo: defaultForm,\n      saveBtnDisabled: false,\n\n      categoryList: [],\n      attrGroupList: [],\n      attrList: [],\n      fileList: [],\n      filePosterList: [],\n\n      // 图片预览区域url\n      dialogImageUrl: '',\n      // 图片预览对话框\n      dialogImageVisible: false\n    }\n  },\n\n  // 监听器\n  watch: {\n    $route(to, from) {\n      console.log('路由变化......')\n      console.log(to)\n      console.log(from)\n      this.init()\n    }\n  },\n\n  // 生命周期方法（在路由切换，组件不变的情况下不会被调用）\n  created() {\n    console.log('form created ......')\n    this.init()\n  },\n\n  methods: {\n\n    // 表单初始化\n    init() {\n      // debugger\n      if (this.$route.params && this.$route.params.id) {\n        const id = this.$route.params.id\n        this.fetchDataById(id)\n      } else {\n        // 对象拓展运算符：拷贝对象，而不是赋值对象的引用\n        this.skuInfo = { ...defaultForm }\n      }\n\n      this.fetchCategoryList()\n      this.fetchAttrGroupList()\n    },\n\n    fetchCategoryList() {\n      categoryApi.findAllList().then(response => {\n        this.categoryList = response.data\n      })\n    },\n\n    fetchAttrGroupList() {\n      attrGroupApi.findAllList().then(response => {\n        this.attrGroupList = response.data\n      })\n    },\n\n    fetchAttrList(attrGroupId) {\n      attrApi.getList(attrGroupId).then(response => {\n        this.attrList = response.data\n\n        // 修改属性回显\n        debugger\n        if (this.skuInfo.skuAttrValueList.length > 0) {\n          this.attrList.forEach(attrItem => {\n            this.skuInfo.skuAttrValueList.forEach(valueItem => {\n              if (attrItem.id === valueItem.attrId) {\n                attrItem.value = valueItem.attrValue\n              }\n            })\n          })\n        }\n      })\n    },\n\n    getParamSelectList(selectList) {\n      return selectList.split(',')\n    },\n\n    selectAttrChange(attrGroupId) {\n      this.fetchAttrList(attrGroupId)\n    },\n\n    saveOrUpdate() {\n      // this.saveBtnDisabled = true // 防止表单重复提交\n      if (!this.skuInfo.id) {\n        this.saveData()\n      } else {\n        this.updateData()\n      }\n    },\n\n    // 新增\n    saveData() {\n      const attrListArray = []\n      this.attrList.forEach(item => {\n        attrListArray.push({\n          attrId: item.id,\n          attrName : item.name,\n          attrValue : item.value\n        })\n      })\n      this.skuInfo.skuAttrValueList = attrListArray\n      if (this.skuInfo.skuImagesList.length > 0) {\n        this.skuInfo.imgUrl = this.skuInfo.skuImagesList[0].imgUrl\n      }\n      api.save(this.skuInfo).then(response => {\n        if (response.code) {\n          this.$message({\n            type: 'success',\n            message: response.message\n          })\n          this.$router.push({ path: '/product/skuInfo/list' })\n          this.saveBtnDisabled = false\n        }\n      })\n    },\n\n    // 根据id更新记录\n    updateData() {\n      debugger\n      const attrListArray = []\n      this.attrList.forEach(item => {\n        attrListArray.push({\n          attrId: item.id,\n          attrName : item.name,\n          attrValue : item.value\n        })\n      })\n      this.skuInfo.skuAttrValueList = attrListArray\n      if (this.skuInfo.skuImagesList.length > 0) {\n        this.skuInfo.imgUrl = this.skuInfo.skuImagesList[0].imgUrl\n      }\n      api.updateById(this.skuInfo).then(response => {\n        if (response.code) {\n          this.$message({\n            type: 'success',\n            message: response.message\n          })\n          this.$router.push({ path: '/product/skuInfo/list' })\n        }\n      })\n    },\n\n    back() {\n      this.$router.push({ path: '/product/skuInfo/list' })\n    },\n\n    // 根据id查询记录\n    fetchDataById(id) {\n      api.getById(id).then(response => {\n        debugger\n        this.skuInfo = response.data\n\n        // 平台属性回显\n        this.fetchAttrList(this.skuInfo.attrGroupId)\n\n        // 图片回显\n        this.skuInfo.skuImagesList.forEach(item => {\n          let obj = new Object()\n          obj.url = item.imgUrl\n          this.fileList.push(obj)\n        })\n\n        this.skuInfo.skuPosterList.forEach(item => {\n          let obj = new Object()\n          obj.url = item.imgUrl\n          this.filePosterList.push(obj)\n        })\n      })\n    },\n\n    // 文件上传限制条件\n    beforeUpload(file) {\n      const isJPG = file.type === 'image/jpeg'\n      const isPNG = file.type === 'image/png'\n      const isGIF = file.type === 'image/gif'\n      const isLt2M = file.size / 1024 / 1024 < 2\n\n      if (!isJPG && !isPNG && !isGIF) {\n        this.$message.error('上传头像图片只能是 JPG、PNG 或 GIF 格式!')\n        return false\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!')\n        return false\n      }\n      return true\n    },\n\n    // 上传图片成功的回调\n    onUploadSuccess(res, file) {\n      // 填充上传文件列表\n      this.skuInfo.skuImagesList.push({\n        imgName: file.name,\n        imgUrl: file.response.data\n      })\n    },\n\n    // 上传的文件预览\n    onUploadPreview(file) {\n      this.dialogImageUrl = file.url\n      this.dialogImageVisible = true\n    },\n\n    // 删除上传的文件\n    onUploadRemove(file, fileList) {\n      var list = []\n      this.skuInfo.skuImagesList.forEach(item => {\n        if(file.url != item.imgUrl) {\n          list.push(item)\n        }\n      })\n      this.skuInfo.skuImagesList = list\n    },\n\n    //-----------------\n    // 上传图片成功的回调\n    onUploadPosterSuccess(res, file) {\n      debugger\n      // 填充上传文件列表\n      this.skuInfo.skuPosterList.push({\n        imgName: file.name,\n        imgUrl: file.response.data\n      })\n    },\n\n    // 删除上传的文件\n    onUploadPosterRemove(file, fileList) {\n      var list = []\n      this.skuInfo.skuPosterList.forEach(item => {\n        if(file.url != item.imgUrl) {\n          list.push(item)\n        }\n      })\n      this.skuInfo.skuPosterList = list\n    }\n\n  }\n}\n</script>\n<style scoped>\n\n  .littleMarginTop {\n    margin-top: 10px;\n  }\n\n  .paramInput {\n    width: 250px;\n  }\n\n  .paramInputLabel {\n    display: inline-block;\n    width: 100px;\n    text-align: right;\n    padding-right: 10px\n  }\n\n  .cardBg {\n    background: #F8F9FC;\n  }\n</style>\n"]}]}