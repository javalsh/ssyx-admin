{"remainingRequest":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/activity/activityInfo/rule.vue?vue&type=style&index=0&id=306a1908&lang=css&","dependencies":[{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/activity/activityInfo/rule.vue","mtime":1678783600000},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/css-loader/dist/cjs.js","mtime":1688442891416},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1688442881225},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/postcss-loader/src/index.js","mtime":1688442891149},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/cache-loader/dist/cjs.js","mtime":1688442891160},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js","mtime":1688442880248}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYXBwLWNvbnRhaW5lciBoNCB7CiAgY29sb3I6ICM2MDYyNjY7Cn0K"},{"version":3,"sources":["rule.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuTA;AACA;AACA","file":"rule.vue","sourceRoot":"src/views/activity/activityInfo","sourcesContent":["<template>\n  <div class=\"app-container\">\n\n    <h4>活动信息</h4>\n    <table class=\"table table-striped table-condenseda table-bordered\" width=\"100%\">\n      <tbody>\n      <tr>\n        <th width=\"15%\">活动标题</th>\n        <td width=\"35%\"><b style=\"font-size: 14px\">{{ activityInfo.activityName }}</b></td>\n        <th width=\"15%\">活动时间</th>\n        <td width=\"35%\">{{ activityInfo.startTime }}至{{ activityInfo.endTime }}</td>\n      </tr>\n      <tr>\n        <th>活动类型</th>\n        <td>{{ activityInfo.activityTypeString }}</td>\n        <th>创建时间</th>\n        <td>{{ activityInfo.createTime }}</td>\n      </tr>\n      <tr>\n        <th>活动描述</th>\n        <td colspan=\"3\">{{ activityInfo.activityDesc }}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <el-dialog title=\"添加规则\" :visible.sync=\"dialogRuleVisible\" width=\"490px\">\n      <el-form label-width=\"120px\" >\n        <el-form-item v-if=\"activityInfo.activityType == 'FULL_REDUCTION'\" label=\"满减金额\">\n          <el-input v-model=\"activityRule.conditionAmount\"/>\n        </el-form-item>\n\n        <el-form-item v-if=\"activityInfo.activityType == 'FULL_REDUCTION'\" label=\"优惠金额\">\n          <el-input v-model=\"activityRule.benefitAmount\"/>\n        </el-form-item>\n\n        <el-form-item v-if=\"activityInfo.activityType == 'FULL_DISCOUNT'\" label=\"满减件数\">\n          <el-input v-model=\"activityRule.conditionNum\"/>\n        </el-form-item>\n\n        <el-form-item v-if=\"activityInfo.activityType == 'FULL_DISCOUNT'\" label=\"优惠折扣\">\n          <el-input v-model=\"activityRule.benefitDiscount\"/>\n        </el-form-item>\n\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"add\">添加</el-button>\n          <el-button type=\"\" @click=\"dialogRuleVisible = false\">取消</el-button>\n        </el-form-item>\n      </el-form>\n    </el-dialog>\n    <h4>\n      规则列表&nbsp;&nbsp;&nbsp;\n      <el-button type=\"\" size=\"mini\" @click=\"dialogRuleVisible = true\">添加规则</el-button>\n    </h4>\n    <el-table\n      v-loading=\"listLoading\"\n      :data=\"activityRuleList\"\n      border\n      fit\n      highlight-current-row>\n\n      <el-table-column\n        label=\"序号\"\n        width=\"70\"\n        align=\"center\">\n        <template slot-scope=\"scope\">\n          {{ scope.$index + 1 }}\n        </template>\n      </el-table-column>\n\n      <el-table-column label=\"活动类型\" >\n\n          {{ activityInfo.activityType == 'FULL_REDUCTION' ? '满减' : '满量打折' }}\n        \n      </el-table-column>\n\n      <el-table-column v-if=\"activityInfo.activityType == 'FULL_REDUCTION'\" prop=\"conditionAmount\" label=\"满减金额\" />\n      <el-table-column v-if=\"activityInfo.activityType == 'FULL_REDUCTION'\" prop=\"benefitAmount\" label=\"优惠金额\" />\n\n      <el-table-column v-if=\"activityInfo.activityType == 'FULL_DISCOUNT'\" prop=\"conditionNum\" label=\"满减量数\" />\n      <el-table-column v-if=\"activityInfo.activityType == 'FULL_DISCOUNT'\" prop=\"benefitDiscount\" label=\"优惠折扣\" />\n\n      <el-table-column label=\"操作\" width=\"200\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"text\" size=\"mini\" @click=\"removeDataById(scope.$index)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-dialog title=\"添加活动范围\" :visible.sync=\"dialogRangVisible\" width=\"490px\">\n      <div style=\"margin-top: 20px;\">\n        <el-form :inline=\"true\" class=\"demo-form-inline\">\n          <el-form-item>\n            <el-autocomplete\n              v-model=\"keyword\"\n              :fetch-suggestions=\"querySearch\"\n              :trigger-on-focus=\"false\"\n              class=\"inline-input\"\n              placeholder=\"请输入关键字，选择活动商品\"\n              value-key=\"skuName\"\n              style=\"width: 400px;\"\n              @select=\"selectData\"\n            />\n          </el-form-item>\n\n          <el-form-item>\n            <el-button type=\"\" @click=\"dialogRangVisible = false\">取消</el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </el-dialog>\n    <h4>\n      活动范围列表&nbsp;&nbsp;&nbsp;\n      <el-button type=\"\" size=\"mini\" @click=\"dialogRangVisible = true\">添加活动范围</el-button>\n    </h4>\n    <el-table\n      v-loading=\"listLoading\"\n      :data=\"skuInfoList\"\n      border\n      fit\n      highlight-current-row>\n\n      <el-table-column\n        label=\"序号\"\n        width=\"70\"\n        align=\"center\">\n        <template slot-scope=\"scope\">\n          {{ scope.$index + 1 }}\n        </template>\n      </el-table-column>\n\n      <el-table-column prop=\"id\" label=\"SKU ID\" width=\"100\"/>\n      <el-table-column label=\"图片\" width=\"320\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <div class=\"info\">\n            <div class=\"pic\">\n              <img :src=\"scope.row.imgUrl\" alt=\"scope.row.title\" style=\"width: 50px;\">\n            </div>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"skuName\" label=\"名称\" />\n      <el-table-column prop=\"price\" label=\"价格\" width=\"70\"/>\n\n      <el-table-column label=\"操作\" width=\"200\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"text\" size=\"mini\" @click=\"removeSkuDataById(scope.$index)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <div style=\"margin-top: 15px;\">\n      <el-form label-width=\"0px\">\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"save\">保存</el-button>\n          <el-button @click=\"back\">返回</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport api from '@/api/activity/activityInfo'\n\nconst defaultForm = {\n  activityId: '',\n  conditionAmount: '',\n  conditionNum: '',\n  benefitAmount: '',\n  benefitDiscount: '',\n  benefitLevel: ''\n}\n\nexport default {\n  data() {\n    return {\n      listLoading: true, // 数据是否正在加载\n\n      activityRule: defaultForm,\n      saveBtnDisabled: false,\n\n      dialogRuleVisible: false,\n      activityInfo: null,\n      activityRuleList: [],\n\n      dialogRangVisible: false,\n      keyword: '',\n      skuInfoList: [],\n\n      dialogCouponVisible: false,\n      couponInfoList: []\n    }\n  },\n\n  // 监听器\n  watch: {\n    $route(to, from) {\n      console.log('路由变化......')\n      console.log(to)\n      console.log(from)\n      this.init()\n    }\n  },\n\n  // 生命周期方法（在路由切换，组件不变的情况下不会被调用）\n  created() {\n    console.log('form created ......')\n    this.init()\n  },\n\n  methods: {\n\n    // 表单初始化\n    init() {\n      const activityId = this.$route.params.id\n      this.fetchDataById(activityId)\n\n      this.fetchRuleDataById(activityId)\n    },\n\n    // 新增\n    add() {\n      this.activityRuleList.push(\n        {\n          activityId: this.activityInfo.id,\n          conditionAmount: this.activityRule.conditionAmount,\n          conditionNum: this.activityRule.conditionNum,\n          benefitAmount: this.activityRule.benefitAmount,\n          benefitDiscount: this.activityRule.benefitDiscount\n        }\n      )\n\n      this.activityRule = defaultForm\n      this.dialogRuleVisible = false\n    },\n\n    save() {\n      const skuList = []\n      this.skuInfoList.forEach(function(item) {\n        skuList.push({\n          skuId: item.id\n        })\n      })\n      const couponIdList = []\n      this.couponInfoList.forEach(function(item) {\n        couponIdList.push(item.id)\n      })\n      const ruleData = {\n        activityId: this.activityInfo.id,\n        activityRuleList: this.activityRuleList,\n        activitySkuList: skuList,\n        couponIdList: couponIdList\n      }\n      debugger\n      api.saveActivityRule(ruleData).then(response => {\n        this.$message.success(response.message)\n        this.$router.push({ path: '/activity/activityInfo/list' })\n      })\n    },\n\n    removeDataById(index) {\n      this.activityRuleList.splice(index, 1)\n    },\n\n    back() {\n      this.$router.push({ path: '/activity/activityInfo/list' })\n    },\n\n    fetchRuleDataById(id) {\n      api.findActivityRuleList(id).then(response => {\n        // debugger\n        this.activityRuleList = response.data.activityRuleList || []\n        this.skuInfoList = response.data.skuInfoList || []\n        this.couponInfoList = response.data.couponInfoList || []\n\n        this.listLoading = false\n      })\n    },\n\n    // 根据id查询记录\n    fetchDataById(id) {\n      api.getById(id).then(response => {\n        // debugger\n        this.activityInfo = response.data\n      })\n    },\n\n    // sku\n    querySearch(queryString, cb) {\n      console.log(queryString)\n      console.log(cb)\n\n      api.findSkuInfoByKeyword(queryString).then(response => {\n        // 调用 callback 返回建议列表的数据\n        cb(response.data)\n      })\n    },\n\n    selectData(item) {\n      this.skuInfoList.push(item)\n      this.dialogRangVisible = false\n    },\n\n    removeSkuDataById(index) {\n      this.skuInfoList.splice(index, 1)\n    }\n  }\n}\n</script>\n<style>\n  .app-container h4 {\n    color: #606266;\n  }\n</style>\n"]}]}