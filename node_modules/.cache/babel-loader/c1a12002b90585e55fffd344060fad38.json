{"remainingRequest":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/babel-loader/lib/index.js!/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/acl/role/roleAuth.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/src/views/acl/role/roleAuth.vue","mtime":1678063974000},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/babel.config.js","mtime":1637306514000},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/cache-loader/dist/cjs.js","mtime":1688442891160},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/babel-loader/lib/index.js","mtime":1688442878961},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/cache-loader/dist/cjs.js","mtime":1688442891160},{"path":"/Users/liushaohua/Project/ssyx-web/ssyx-admin/node_modules/vue-loader/lib/index.js","mtime":1688442880248}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdyb2xlQXV0aCcsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICAvLyDnlKjmnaXmoIfor4bmmK/lkKbmraPlnKjkv53lrZjor7fmsYLkuK3nmoTmoIfor4YsIOmYsuatoumHjeWkjeaPkOS6pAogICAgICBhbGxQZXJtaXNzaW9uczogW10sCiAgICAgIC8vIOaJgOaciQogICAgICBkZWZhdWx0UHJvcHM6IHsKICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgICBsYWJlbDogJ25hbWUnCiAgICAgIH0KICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5pbml0KCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvKgogICAg5Yid5aeL5YyWCiAgICAqLwogICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgdmFyIHJvbGVJZCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgdGhpcy5nZXRQZXJtaXNzaW9ucyhyb2xlSWQpOwogICAgfSwKICAgIC8qCiAgICDojrflj5bmjIflrprop5LoibLnmoTmnYPpmZDliJfooagKICAgICovCiAgICBnZXRQZXJtaXNzaW9uczogZnVuY3Rpb24gZ2V0UGVybWlzc2lvbnMocm9sZUlkKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuJEFQSS5wZXJtaXNzaW9uLnRvQXNzaWduKHJvbGVJZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgdmFyIGFsbFBlcm1pc3Npb25zID0gcmVzdWx0LmRhdGE7CiAgICAgICAgX3RoaXMuYWxsUGVybWlzc2lvbnMgPSBhbGxQZXJtaXNzaW9uczsKICAgICAgICB2YXIgY2hlY2tlZElkcyA9IF90aGlzLmdldENoZWNrZWRJZHMoYWxsUGVybWlzc2lvbnMpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCdnZXRQZXJtaXNzaW9ucygpIGNoZWNrZWRJZHMnLCBjaGVja2VkSWRzKQogICAgICAgIF90aGlzLiRyZWZzLnRyZWUuc2V0Q2hlY2tlZEtleXMoY2hlY2tlZElkcyk7CiAgICAgIH0pOwogICAgfSwKICAgIC8qCiAgICDlvpfliLDmiYDmnInpgInkuK3nmoRpZOWIl+ihqAogICAgKi8KICAgIGdldENoZWNrZWRJZHM6IGZ1bmN0aW9uIGdldENoZWNrZWRJZHMoYXV0aHMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHZhciBpbml0QXJyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBbXTsKICAgICAgcmV0dXJuIGF1dGhzLnJlZHVjZShmdW5jdGlvbiAocHJlLCBpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW0uc2VsZWN0ICYmIGl0ZW0ubGV2ZWwgPT09IDQpIHsKICAgICAgICAgIHByZS5wdXNoKGl0ZW0uaWQpOwogICAgICAgIH0gZWxzZSBpZiAoaXRlbS5jaGlsZHJlbikgewogICAgICAgICAgX3RoaXMyLmdldENoZWNrZWRJZHMoaXRlbS5jaGlsZHJlbiwgaW5pdEFycik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcmU7CiAgICAgIH0sIGluaXRBcnIpOwogICAgfSwKICAgIC8qCiAgICDkv53lrZjmnYPpmZDliJfooagKICAgICovCiAgICBzYXZlOiBmdW5jdGlvbiBzYXZlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdmFyIGlkcyA9IHRoaXMuJHJlZnMudHJlZS5nZXRDaGVja2VkS2V5cygpLmpvaW4oIiwiKTsKICAgICAgLyoKICAgICAgdnVlIGVsZW1lbnRVSSB0cmVl5qCR5b2i5o6n5Lu26I635Y+W54i26IqC54K5SUTnmoTlrp7kvosKICAgICAg5L+u5pS55rqQ56CBOgogICAgICDmg4XlhrUxOiBlbGVtZW50LXVp5rKh5pyJ5a6e546w5oyJ6ZyA5byV5YWl5omT5YyFCiAgICAgICAgbm9kZV9tb2R1bGVzXGVsZW1lbnQtdWlcbGliXGVsZW1lbnQtdWkuY29tbW9uLmpzICAgIDI1Mzgy6KGM5L+u5pS55rqQ56CBICDljrvmjokgJ2luY2x1ZGVIYWxmQ2hlY2tlZCAmJicKICAgICAgICAvLyBpZiAoKGNoaWxkLmNoZWNrZWQgfHwgaW5jbHVkZUhhbGZDaGVja2VkICYmIGNoaWxkLmluZGV0ZXJtaW5hdGUpICYmICghbGVhZk9ubHkgfHwgbGVhZk9ubHkgJiYgY2hpbGQuaXNMZWFmKSkgewogICAgICAgIGlmICgoY2hpbGQuY2hlY2tlZCB8fCBjaGlsZC5pbmRldGVybWluYXRlKSAmJiAoIWxlYWZPbmx5IHx8IGxlYWZPbmx5ICYmIGNoaWxkLmlzTGVhZikpIHsKICAgICAg5oOF5Ya1MjogZWxlbWVudC11aeWunueOsOS6huaMiemcgOW8leWFpeaJk+WMhQogICAgICAgIG5vZGVfbW9kdWxlc1xlbGVtZW50LXVpXGxpYlx0cmVlLmpzICAgIDEwNTHooYzkv67mlLnmupDnoIEgIOWOu+aOiSAnaW5jbHVkZUhhbGZDaGVja2VkICYmJwogICAgICAgIC8vIGlmICgoY2hpbGQuY2hlY2tlZCB8fCBpbmNsdWRlSGFsZkNoZWNrZWQgJiYgY2hpbGQuaW5kZXRlcm1pbmF0ZSkgJiYgKCFsZWFmT25seSB8fCBsZWFmT25seSAmJiBjaGlsZC5pc0xlYWYpKSB7CiAgICAgICAgaWYgKChjaGlsZC5jaGVja2VkIHx8IGNoaWxkLmluZGV0ZXJtaW5hdGUpICYmICghbGVhZk9ubHkgfHwgbGVhZk9ubHkgJiYgY2hpbGQuaXNMZWFmKSkgewogICAgICAqLwogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLiRBUEkucGVybWlzc2lvbi5kb0Fzc2lnbih0aGlzLiRyb3V0ZS5wYXJhbXMuaWQsIGlkcykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgX3RoaXMzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczMuJG1lc3NhZ2Uuc3VjY2VzcyhyZXN1bHQuJG1lc3NhZ2UgfHwgJ+WIhumFjeadg+mZkOaIkOWKnycpOwogICAgICAgIC8vIOW/hemhu+WcqOi3s+i9rOWJjeiOt+WPlijot7PovazlkI7pgJrov4d0aGlz6I635Y+W5LiN5Yiw5q2j56Gu55qE5pWw5o2u5LqGKQogICAgICAgIHZhciByb2xlTmFtZSA9IF90aGlzMy4kcm91dGUucXVlcnkucm9sZU5hbWU7CiAgICAgICAgdmFyIHJvbGVzID0gX3RoaXMzLiRzdG9yZS5nZXR0ZXJzLnJvbGVzOwogICAgICAgIF90aGlzMy4kcm91dGVyLnJlcGxhY2UoJy9hY2wvcm9sZS9saXN0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coJ3JlcGxhY2Ugb25Db21wbGV0ZScpOwogICAgICAgICAgLy8g6Lez6L2s5oiQ5Yqf5ZCOLCDliKTmlq3lpoLmnpzmm7TmlrDnmoTmmK/lvZPliY3nlKjmiLflr7nlupTop5LoibLnmoTmnYPpmZAsIOmHjeaWsOWKoOi9vemhtemdouS7peiOt+W+l+acgOaWsOeahOaVsOaNrgogICAgICAgICAgaWYgKHJvbGVzLmluY2x1ZGVzKHJvbGVOYW1lKSkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KfTs="},{"version":3,"names":["name","data","loading","allPermissions","defaultProps","children","label","created","init","methods","roleId","$route","params","id","getPermissions","_this","$API","permission","toAssign","then","result","checkedIds","getCheckedIds","$refs","tree","setCheckedKeys","auths","_this2","initArr","arguments","length","undefined","reduce","pre","item","select","level","push","save","_this3","ids","getCheckedKeys","join","doAssign","$message","success","roleName","query","roles","$store","getters","$router","replace","console","log","includes","window","location","reload"],"sources":["src/views/acl/role/roleAuth.vue"],"sourcesContent":["<template>\n  <div>\n    <el-input disabled :value=\"$route.query.roleName\"></el-input>\n    <el-tree\n      style=\"margin: 20px 0\"\n      ref=\"tree\"\n      :data=\"allPermissions\"\n      node-key=\"id\"\n      show-checkbox\n      default-expand-all\n      :props=\"defaultProps\"\n    />\n    <el-button :loading=\"loading\" type=\"primary\" @click=\"save\">保存</el-button>\n    <el-button @click=\"$router.replace({name: 'Role'})\">取消</el-button>\n  </div>\n</template>\n<script>\n\n  export default {\n    name: 'roleAuth',\n\n    data() {\n      return {\n        loading: false, // 用来标识是否正在保存请求中的标识, 防止重复提交\n        allPermissions: [], // 所有\n        defaultProps: {\n          children: 'children',\n          label: 'name'\n        },\n      };\n    },\n\n    created() {\n      this.init()\n    },\n\n    methods: {\n      /*\n      初始化\n      */\n      init() {\n        const roleId = this.$route.params.id\n        this.getPermissions(roleId)\n      },\n\n      /*\n      获取指定角色的权限列表\n      */\n      getPermissions(roleId) {\n        this.$API.permission.toAssign(roleId).then(result => {\n          const allPermissions = result.data\n          this.allPermissions = allPermissions\n          const checkedIds = this.getCheckedIds(allPermissions)\n          // console.log('getPermissions() checkedIds', checkedIds)\n          this.$refs.tree.setCheckedKeys(checkedIds)\n        })\n      },\n\n      /*\n      得到所有选中的id列表\n      */\n      getCheckedIds (auths, initArr = []) {\n        return auths.reduce((pre, item) => {\n          if (item.select && item.level===4) {\n            pre.push(item.id)\n          } else if (item.children) {\n            this.getCheckedIds(item.children, initArr)\n          }\n          return pre\n        }, initArr)\n      },\n\n      /*\n      保存权限列表\n      */\n      save() {\n        var ids = this.$refs.tree.getCheckedKeys().join(\",\")\n        /*\n        vue elementUI tree树形控件获取父节点ID的实例\n        修改源码:\n        情况1: element-ui没有实现按需引入打包\n          node_modules\\element-ui\\lib\\element-ui.common.js    25382行修改源码  去掉 'includeHalfChecked &&'\n          // if ((child.checked || includeHalfChecked && child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n          if ((child.checked || child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n        情况2: element-ui实现了按需引入打包\n          node_modules\\element-ui\\lib\\tree.js    1051行修改源码  去掉 'includeHalfChecked &&'\n          // if ((child.checked || includeHalfChecked && child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n          if ((child.checked || child.indeterminate) && (!leafOnly || leafOnly && child.isLeaf)) {\n        */\n        this.loading = true\n        this.$API.permission.doAssign(this.$route.params.id, ids).then(result => {\n          this.loading = false\n          this.$message.success(result.$message || '分配权限成功')\n          // 必须在跳转前获取(跳转后通过this获取不到正确的数据了)\n          const roleName = this.$route.query.roleName\n          const roles = this.$store.getters.roles\n          this.$router.replace('/acl/role/list', () => {\n            console.log('replace onComplete')\n            // 跳转成功后, 判断如果更新的是当前用户对应角色的权限, 重新加载页面以获得最新的数据\n            if (roles.includes(roleName)) {\n              window.location.reload()\n            }\n          })\n        })\n      }\n    }\n  };\n</script>\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAkBA;EACAA,IAAA;EAEAC,IAAA,WAAAA,KAAA;IACA;MACAC,OAAA;MAAA;MACAC,cAAA;MAAA;MACAC,YAAA;QACAC,QAAA;QACAC,KAAA;MACA;IACA;EACA;EAEAC,OAAA,WAAAA,QAAA;IACA,KAAAC,IAAA;EACA;EAEAC,OAAA;IACA;AACA;AACA;IACAD,IAAA,WAAAA,KAAA;MACA,IAAAE,MAAA,QAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;MACA,KAAAC,cAAA,CAAAJ,MAAA;IACA;IAEA;AACA;AACA;IACAI,cAAA,WAAAA,eAAAJ,MAAA;MAAA,IAAAK,KAAA;MACA,KAAAC,IAAA,CAAAC,UAAA,CAAAC,QAAA,CAAAR,MAAA,EAAAS,IAAA,WAAAC,MAAA;QACA,IAAAjB,cAAA,GAAAiB,MAAA,CAAAnB,IAAA;QACAc,KAAA,CAAAZ,cAAA,GAAAA,cAAA;QACA,IAAAkB,UAAA,GAAAN,KAAA,CAAAO,aAAA,CAAAnB,cAAA;QACA;QACAY,KAAA,CAAAQ,KAAA,CAAAC,IAAA,CAAAC,cAAA,CAAAJ,UAAA;MACA;IACA;IAEA;AACA;AACA;IACAC,aAAA,WAAAA,cAAAI,KAAA;MAAA,IAAAC,MAAA;MAAA,IAAAC,OAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA;MACA,OAAAH,KAAA,CAAAM,MAAA,WAAAC,GAAA,EAAAC,IAAA;QACA,IAAAA,IAAA,CAAAC,MAAA,IAAAD,IAAA,CAAAE,KAAA;UACAH,GAAA,CAAAI,IAAA,CAAAH,IAAA,CAAArB,EAAA;QACA,WAAAqB,IAAA,CAAA7B,QAAA;UACAsB,MAAA,CAAAL,aAAA,CAAAY,IAAA,CAAA7B,QAAA,EAAAuB,OAAA;QACA;QACA,OAAAK,GAAA;MACA,GAAAL,OAAA;IACA;IAEA;AACA;AACA;IACAU,IAAA,WAAAA,KAAA;MAAA,IAAAC,MAAA;MACA,IAAAC,GAAA,QAAAjB,KAAA,CAAAC,IAAA,CAAAiB,cAAA,GAAAC,IAAA;MACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACA,KAAAxC,OAAA;MACA,KAAAc,IAAA,CAAAC,UAAA,CAAA0B,QAAA,MAAAhC,MAAA,CAAAC,MAAA,CAAAC,EAAA,EAAA2B,GAAA,EAAArB,IAAA,WAAAC,MAAA;QACAmB,MAAA,CAAArC,OAAA;QACAqC,MAAA,CAAAK,QAAA,CAAAC,OAAA,CAAAzB,MAAA,CAAAwB,QAAA;QACA;QACA,IAAAE,QAAA,GAAAP,MAAA,CAAA5B,MAAA,CAAAoC,KAAA,CAAAD,QAAA;QACA,IAAAE,KAAA,GAAAT,MAAA,CAAAU,MAAA,CAAAC,OAAA,CAAAF,KAAA;QACAT,MAAA,CAAAY,OAAA,CAAAC,OAAA;UACAC,OAAA,CAAAC,GAAA;UACA;UACA,IAAAN,KAAA,CAAAO,QAAA,CAAAT,QAAA;YACAU,MAAA,CAAAC,QAAA,CAAAC,MAAA;UACA;QACA;MACA;IACA;EACA;AACA"}]}